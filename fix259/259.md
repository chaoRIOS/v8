### structure
load sequence

`WebAssembly.Memory` --> `buffer`:

 - `gSharedMemory` --> `gSharedMemoryView`
 - `gPrivateMemory` --> `gSharedMemoryView`

`WasmModuleBuilder` --> 

 - `WebAssembly.Module` --> `WebAssembly.Instance`







### `Operation`

 - **size**: 64, 32, 16,8 bits

 - `WasmModuleBuilder` ==> `Operation.__builder` ==> `evalfunc`

 - `WebAssembly.Instance`==>`Operation.instance`

 - Static get methods
    - **builder**: `WasmModuleBuilder`
    
    - **exports**: `WebAssembly.Instance.exports`
    
    - **memory**: `WebAssembly.Instance.exports.mem`
    
    - **key**: String, "`opcode`-`offset`"
    
    - **instance**: `WebAssembly.Instance`
    
      - ```javascript
        declare namespace WebAssembly {
            ...
            interface Instance {
                readonly exports: Exports;
            }
            
            var Instance: {
                prototype: Instance;
                new(module: Module, importObject?: Imports): Instance;
            };
            ...
        }
        ```
        
        
    
 - `truncateResultBits`: calculate with offset

 - compute(`state`): 

     - ```js
        // Add and export function body.
        builder.addFunction(this.key, kSig_v_iiii)
            .addBody(body)
            .exportAs(this.key);
        
        // Instantiate module, get function exports.
        let module = new WebAssembly.Module(builder.toBuffer());
        
        Operation.instance =
            new WebAssembly.Instance(module, {m: {imported_mem: gPrivateMemory}});
        evalFun = Operation.exports[this.key];
        
        // Or use existing evalFun
        
        evalFun(state.low, state.high, this.low_input, this.high_input);
        let ta = gPrivateMemoryView;
        return {low: ta[0], high: ta[1]};
        ```

     - Corresponding Wasm syntax

         - LocalGet







### `State`

- low
- high
- indices
- count: ranges from 0 to NumWorkers * SeqLength



### Global functions

| function                          | description                                 |
| --------------------------------- | ------------------------------------------- |
| `makeSequenceOfOperations`        | new Operation()                             |
| `toSLeb128`                       | SLEB128(Signed Little Endian Base) encoding |
| `generateFunctionBodyForSequence` | Generate WASM function body                 |
| `getSequence`                     | Generate Int32Array sequence                |
| `spawnWorkers`                    | Create Workers with `init` and `exec` msg   |
| `instantiateModuleInWorkers`      | Self-send 'INIT' msg, definded in `spawn()` |
| `executeSequenceInWorkers`        | Exec via `exports[workerindex]`             |
| `selectMatchingWorkers`           | Match seq[worker][step] : result[w][2s:2s+1]|
| `computeNextState`                | Op on stated by i-th worker, its index++    |
| `findSequentialOrdering`          | Judging procedure                           |

























































